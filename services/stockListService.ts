import { Candle, StockData, TechnicalSignals, AppSettings, AssetType } from "../types";

const STATIC_NSE_LIST = `Symbol
360ONE
3MINDIA
ABB
ACC
ACMESOLAR
AIAENG
APLAPOLLO
AUBANK
AWL
AADHARHFC
AARTIIND
AAVAS
ABBOTINDIA
ACE
ADANIENSOL
ADANIENT
ADANIGREEN
ADANIPORTS
ADANIPOWER
ATGL
ABCAPITAL
ABFRL
ABLBL
ABREL
ABSLAMC
AEGISLOG
AEGISVOPAK
AFCONS
AFFLE
AJANTPHARM
AKUMS
AKZOINDIA
APLLTD
ALKEM
ALKYLAMINE
ALOKINDS
ARE&M
AMBER
AMBUJACEM
ANANDRATHI
ANANTRAJ
ANGELONE
APARINDS
APOLLOHOSP
APOLLOTYRE
APTUS
ASAHIINDIA
ASHOKLEY
ASIANPAINT
ASTERDM
ASTRAZEN
ASTRAL
ATHERENERG
ATUL
AUROPHARMA
AIIL
DMART
AXISBANK
BASF
BEML
BLS
BSE
BAJAJ-AUTO
BAJFINANCE
BAJAJFINSV
BAJAJHLDNG
BAJAJHFL
BALKRISIND
BALRAMCHIN
BANDHANBNK
BANKBARODA
BANKINDIA
MAHABANK
BATAINDIA
BAYERCROP
BERGEPAINT
BDL
BEL
BHARATFORG
BHEL
BPCL
BHARTIARTL
BHARTIHEXA
BIKAJI
BIOCON
BSOFT
BLUEDART
BLUEJET
BLUESTARCO
BBTC
BOSCHLTD
FIRSTCRY
BRIGADE
BRITANNIA
MAPMYINDIA
CCL
CESC
CGPOWER
CRISIL
CAMPUS
CANFINHOME
CANBK
CAPLIPOINT
CGCL
CARBORUNIV
CASTROLIND
CEATLTD
CENTRALBK
CDSL
CENTURYPLY
CERA
CHALET
CHAMBLFERT
CHENNPETRO
CHOICEIN
CHOLAHLDNG
CHOLAFIN
CIPLA
CUB
CLEAN
COALINDIA
COCHINSHIP
COFORGE
COHANCE
COLPAL
CAMS
CONCORDBIO
CONCOR
COROMANDEL
CRAFTSMAN
CREDITACC
CROMPTON
CUMMINSIND
CYIENT
DCMSHRIRAM
DLF
DOMS
DABUR
DALBHARAT
DATAPATTNS
DEEPAKFERT
DEEPAKNTR
DELHIVERY
DEVYANI
DIVISLAB
DIXON
AGARWALEYE
LALPATHLAB
DRREDDY
DUMMYHDLVR
EIDPARRY
EIHOTEL
EICHERMOT
ELECON
ELGIEQUIP
EMAMILTD
EMCURE
ENDURANCE
ENGINERSIN
ERIS
ESCORTS
ETERNAL
EXIDEIND
NYKAA
FEDERALBNK
FACT
FINCABLES
FINPIPE
FSL
FIVESTAR
FORCEMOT
FORTIS
GAIL
GVT&D
GMRAIRPORT
GRSE
GICRE
GILLETTE
GLAND
GLAXO
GLENMARK
MEDANTA
GODIGIT
GPIL
GODFRYPHLP
GODREJAGRO
GODREJCP
GODREJIND
GODREJPROP
GRANULES
GRAPHITE
GRASIM
GRAVITA
GESHIP
FLUOROCHEM
GUJGASLTD
GMDCLTD
GSPL
HEG
HBLENGINE
HCLTECH
HDFCAMC
HDFCBANK
HDFCLIFE
HFCL
HAPPSTMNDS
HAVELLS
HEROMOTOCO
HEXT
HSCL
HINDALCO
HAL
HINDCOPPER
HINDPETRO
HINDUNILVR
HINDZINC
POWERINDIA
HOMEFIRST
HONASA
HONAUT
HUDCO
HYUNDAI
ICICIBANK
ICICIGI
ICICIPRULI
IDBI
IDFCFIRSTB
IFCI
IIFL
INOXINDIA
IRB
IRCON
ITCHOTELS
ITC
ITI
INDGN
INDIACEM
INDIAMART
INDIANB
IEX
INDHOTEL
IOC
IOB
IRCTC
IRFC
IREDA
IGL
INDUSTOWER
INDUSINDBK
NAUKRI
INFY
INOXWIND
INTELLECT
INDIGO
IGIL
IKS
IPCALAB
JBCHEPHARM
JKCEMENT
JBMA
JKTYRE
JMFINANCIL
JSWENERGY
JSWINFRA
JSWSTEEL
JPPOWER
J&KBANK
JINDALSAW
JSL
JINDALSTEL
JIOFIN
JUBLFOOD
JUBLINGREA
JUBLPHARMA
JWL
JYOTHYLAB
JYOTICNC
KPRMILL
KEI
KPITTECH
KSB
KAJARIACER
KPIL
KALYANKJIL
KARURVYSYA
KAYNES
KEC
KFINTECH
KIRLOSBROS
KIRLOSENG
KOTAKBANK
KIMS
LTF
LTTS
LICHSGFIN
LTFOODS
LTIM
LT
LATENTVIEW
LAURUSLABS
THELEELA
LEMONTREE
LICI
LINDEINDIA
LLOYDSME
LODHA
LUPIN
MMTC
MRF
MGL
MAHSCOOTER
MAHSEAMLES
M&MFIN
M&M
MANAPPURAM
MRPL
MANKIND
MARICO
MARUTI
MFSL
MAXHEALTH
MAZDOCK
METROPOLIS
MINDACORP
MSUMI
MOTILALOFS
MPHASIS
MCX
MUTHOOTFIN
NATCOPHARM
NBCC
NCC
NHPC
NLCINDIA
NMDC
NSLNISP
NTPCGREEN
NTPC
NH
NATIONALUM
NAVA
NAVINFLUOR
NESTLEIND
NETWEB
NEULANDLAB
NEWGEN
NAM-INDIA
NIVABUPA
NUVAMA
NUVOCO
OBEROIRLTY
ONGC
OIL
OLAELEC
OLECTRA
PAYTM
ONESOURCE
OFSS
POLICYBZR
PCBL
PGEL
PIIND
PNBHOUSING
PTCIL
PVRINOX
PAGEIND
PATANJALI
PERSISTENT
PETRONET
PFIZER
PHOENIXLTD
PIDILITIND
PPLPHARMA
POLYMED
POLYCAB
POONAWALLA
PFC
POWERGRID
PRAJIND
PREMIERENE
PRESTIGE
PGHH
PNB
RRKABEL
RBLBANK
RECLTD
RHIM
RITES
RADICO
RVNL
RAILTEL
RAINBOW
RKFORGE
RCF
REDINGTON
RELIANCE
RELINFRA
RPOWER
SBFC
SBICARD
SBILIFE
SJVN
SKFINDUS
SKFINDIA
SRF
SAGILITY
SAILIFE
SAMMAANCAP
MOTHERSON
SAPPHIRE
SARDAEN
SAREGAMA
SCHAEFFLER
SCHNEIDER
SCI
SHREECEM
SHRIRAMFIN
SHYAMMETL
ENRIN
SIEMENS
SIGNATURE
SOBHA
SOLARINDS
SONACOMS
SONATSOFTW
STARHEALTH
SBIN
SAIL
SUMICHEM
SUNPHARMA
SUNTV
SUNDARMFIN
SUNDRMFAST
SUPREMEIND
SUZLON
SWANCORP
SWIGGY
SYNGENE
SYRMA
TBOTEK
TVSMOTOR
TATACHEM
TATACOMM
TCS
TATACONSUM
TATAELXSI
TATAINVEST
TMPV
TATAPOWER
TATASTEEL
TATATECH
TTML
TECHM
TECHNOE
TEJASNET
NIACL
RAMCOCEM
THERMAX
TIMKEN
TITAGARH
TITAN
TORNTPHARM
TORNTPOWER
TARIL
TRENT
TRIDENT
TRIVENI
TRITURBINE
TIINDIA
UCOBANK
UNOMINDA
UPL
UTIAMC
ULTRACEMCO
UNIONBANK
UBL
UNITDSPR
USHAMART
VGUARD
DBREALTY
VTL
VBL
MANYAVAR
VEDL
VENTIVE
VIJAYA
VMM
IDEA
VOLTAS
WAAREEENER
WELCORP
WELSPUNLIV
WHIRLPOOL
WIPRO
WOCKPHARMA
YESBANK
ZFCVINDIA
ZEEL
ZENTEC
ZENSARTECH
ZYDUSLIFE
ECLERX`;

// ✅ UNIVERSES - Compatible with new fetcher [memory:2][memory:3]
export const STATIC_MCX_LIST = [
    "GOLD", "SILVER", "CRUDEOIL", "NATURALGAS", "COPPER", "ZINC", "ALUMINIUM", "LEAD"
];

export const STATIC_FOREX_LIST = [
    "USDINR", "EURINR", "GBPINR", "JPYINR", "EURUSD", "GBPUSD"
];

export const STATIC_CRYPTO_LIST = [
    "BTC/USDT", "ETH/USDT", "SOL/USDT", "BNB/USDT", "XRP/USDT", "ADA/USDT", "DOGE/USDT", "SHIB/USDT"
];

// ✅ NSE UNIVERSE (Without .NS suffix for clean input)
export const NSE_UNIVERSE: string[] = STATIC_NSE_LIST
    .split('\n')
    .slice(1)  // Skip header
    .map(line => line.trim())
    .filter(Boolean)
    .map(sym => sym.toUpperCase().replace(/[^A-Z0-9&-]/g, ''));  // Clean symbols

// ✅ FULL UNIVERSE with all segments (for scanners)
export const FULL_UNIVERSE = [
    ...NSE_UNIVERSE.slice(0, 100),  // Top 100 NSE [memory:16]
    ...STATIC_MCX_LIST,
    ...STATIC_FOREX_LIST, 
    ...STATIC_CRYPTO_LIST
];

let NAME_CACHE: Map<string, string> | null = null;

const initNameCache = (): void => {
    if (NAME_CACHE) return;
    
    NAME_CACHE = new Map<string, string>();
    
    // NSE: symbol → display name (clean format)
    NSE_UNIVERSE.forEach(sym => {
        NAME_CACHE.set(sym, sym);  // e.g., "RELIANCE" → "RELIANCE"
        NAME_CACHE.set(`${sym}.NS`, sym);  // Also cache Yahoo format
    });
    
    // MCX
    STATIC_MCX_LIST.forEach(sym => {
        NAME_CACHE.set(sym, `${sym} Futures`);
        NAME_CACHE.set(`MCX:${sym}M`, `${sym} MCX`);
    });
    
    // Forex
    STATIC_FOREX_LIST.forEach(sym => {
        const base = sym.substring(0, 3);
        const quote = sym.substring(3);
        NAME_CACHE.set(sym, `${base}/${quote}`);
    });
    
    // Crypto
    STATIC_CRYPTO_LIST.forEach(sym => {
        NAME_CACHE.set(sym, sym.replace('/USDT', ''));
    });
};

// ✅ COMPATIBLE getCompanyName - Works with new fetcher
export const getCompanyName = (symbol: string): string => {
    if (!NAME_CACHE) initNameCache();
    
    const upperSymbol = symbol.toUpperCase().trim();
    
    // Exact match
    if (NAME_CACHE.has(upperSymbol)) {
        return NAME_CACHE.get(upperSymbol)!;
    }
    
    // NSE .NS → base symbol
    if (upperSymbol.endsWith('.NS')) {
        const base = upperSymbol.slice(0, -3);
        if (NSE_UNIVERSE.includes(base)) {
            return base;
        }
    }
    
    // Auto NSE detection
    if (NSE_UNIVERSE.includes(upperSymbol)) {
        return upperSymbol;
    }
    
    // Fallbacks
    if (STATIC_MCX_LIST.includes(upperSymbol)) return `${upperSymbol} Futures`;
    if (STATIC_CRYPTO_LIST.includes(upperSymbol)) return upperSymbol.replace('/USDT', '') + ' Crypto';
    if (STATIC_FOREX_LIST.includes(upperSymbol)) return upperSymbol;
    
    return upperSymbol;  // Raw fallback
};

// ✅ COMPATIBLE refresh - Returns CLEAN symbols (no .NS suffix)
export const checkAndRefreshStockList = async (limit: number = 200): Promise<string[]> => {
    // Return first N symbols (user preference: 100-200) [memory:16]
    return NSE_UNIVERSE.slice(0, Math.min(limit, NSE_UNIVERSE.length));
};

// ✅ NEW: Get universe by segment (for scanners)
export const getUniverseByType = (assetType: AssetType): string[] => {
    switch (assetType) {
        case 'stocks': return NSE_UNIVERSE.slice(0, 100);
        case 'mcx': return STATIC_MCX_LIST;
        case 'forex': return STATIC_FOREX_LIST;
        case 'crypto': return STATIC_CRYPTO_LIST;
        default: return FULL_UNIVERSE;
    }
};

// ✅ BATCH VALIDATOR - Filter valid symbols only
export const validateSymbols = (symbols: string[]): string[] => {
    return symbols.filter(sym => {
        const clean = sym.toUpperCase().replace('.NS', '');
        return NSE_UNIVERSE.includes(clean) || 
               STATIC_MCX_LIST.includes(clean) || 
               STATIC_FOREX_LIST.includes(clean) || 
               STATIC_CRYPTO_LIST.includes(clean);
    });
};

// ✅ Usage Examples - Compatible with existing code
/*
const nifty100 = await checkAndRefreshStockList(100);  // ["RELIANCE", "TCS", ...]
const mcx = getUniverseByType('mcx');  // ["GOLD", "SILVER", ...]
const allData = await fetchMultipleSymbols(nifty100, settings);  // Works perfectly
const names = nifty100.map(getCompanyName);  // Clean display names
*/
