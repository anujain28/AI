const STATIC_NSE_LIST = `Symbol
AARTIIND
ABB
ACC
ADANIENT
ADANIGREEN
ADANIPORTS
ADANIPOWER
ADANIENSOL
AIAENG
AJANTPHARM
ALKYLAMINE
AMBUJACEM
ANGELONE
APLLTD
APOLLOTYRE
APOLLOHOSP
APARINDS
ARE&M
ASHOKLEY
ASIANPAINT
AUBANK
AUROPHARMA
AWL
AXISBANK
BAJAJ-AUTO
BAJAJFINSV
BAJFINANCE
BAJAJHLDNG
BALRAMCHIN
BANDHANBNK
BANKBARODA
BANKINDIA
BARBEQUE
BATAINDIA
BDL
BEL
BERGEPAINT
BHEL
BIKAJI
BIOCON
BLUESTARCO
BLS
BOSCHLTD
BPCL
BRITANNIA
BRIGADE
BSOFT
BSE
CAMS
CANBK
CANFINHOME
CAPLIPOINT
CASTROLIND
CEATLTD
CERA
CHAMBLFERT
CHENNPETRO
CHOLAFIN
CIPLA
CLEAN
COALINDIA
COCHINSHIP
COFORGE
COLPAL
CONCOR
COROMANDEL
CREDITACC
CROMPTON
CUB
CUMMINSIND
CYIENT
DABUR
DALBHARAT
DATAPATTNS
DELHIVERY
DEVYANI
DEEPAKNTR
DIVISLAB
DMART
DOMS
DOW
DRREDDY
EICHERMOT
EIHOTEL
ELECON
ELGIEQUIP
EMAMILTD
EMCURE
ENGINERSIN
EPIGRAL
ESCORTS
EVEREADY
EXIDEIND
FACT
FEDERALBNK
FINCABLES
FINPIPE
FORTIS
GAIL
GICRE
GILLETTE
GLAND
GLAXO
GLENMARK
GMDCLTD
GMRINFRA
GODFRYPHLP
GODREJAGRO
GODREJCP
GODREJIND
GODREJPROP
GOLDIAM
GRANULES
GRASIM
GRSE
GUJGASLTD
HAL
HAPPSTMNDS
HAVELLS
HBLENGINE
HCLTECH
HDFCBANK
HDFCAMC
HDFCLIFE
HDFC
HEG
HEROMOTOCO
HIKAL
HINDALCO
HINDCOPPER
HINDPETRO
HINDUNILVR
HINDZINC
HONA
HOTEL
HUDCO
ICICIBANK
ICICIGI
ICICIPRULI
IDFCFIRSTB
IEX
IGL
INDHOTEL
INDIANB
INDIGO
INDUSINDBK
INFY
IOC
IPCALAB
IRCON
IRCTC
IRFC
ITI
JBCHEPHARM
JINDALSTEL
JINDALSAW
JIOFIN
JKCEMENT
JKTYRE
JSL
JSWINFRA
JSWENERGY
JSWSTEEL
JUBLFOOD
JUBLPHARMA
JUBLPHARMA
JWL
KALYANJIL
KAJARIACER
KARURVYSYA
KEC
KFINTECH
KIMS
KOTAKBANK
KPIL
KPITTECH
KPRMILL
LALPATHLAB
LATENTVIEW
LAURUSLABS
LEMONTREE
LICHSGFIN
LICI
LINDEINDIA
LT
LTIM
LTFOODS
LTF
LUPIN
LUXIND
MAHABANK
MAHSEAMLES
MANAPPURAM
MARICO
MARUTI
MAZDOCK
MCX
MEDANTA
METROPOLIS
MFSL
MGL
MINDACORP
MOTHERSON
MPHASIS
MRPL
MUTHOOTFIN
NATIONALUM
NAVINFLUOR
NBCC
NCC
NESTLEIND
NH
NIACL
NMDC
NOCIL
NOVA
NRAIL
NTPC
NTPCGREEN
NYKAA
OIL
OLECTRA
ONGC
PGEL
PIDILITIND
PIIND
PERSISTENT
PETRONET
PHOENIXLTD
PFC
PIDILITIND
PNBHOUSING
POLICYBZR
POWERGRID
PPLPHARMA
PRESTIGE
PSUBANK
PVRINOX
R R KABEL
RAILTEL
RAINBOW
RALLIS
RAMCOCEM
RATNAMANI
RBLBANK
RECLTD
REDINGTON
RELIANCE
RITES
RVNL
SAIL
SBILIFE
SBI
SBIN
SBFC
SCHNEIDER
SCHAEFFLER
SHRIRAMFIN
SHYAMMETL
SIEMENS
SIS
SOBHA
SOLARA
SONACOMS
STARHEALTH
STEELXIND
SUNPHARMA
SUNDARMFIN
SUNDRMFAST
SUZLON
SWIGGY
SYNGENE
TARIL
TATACHEM
TATACOMM
TATACONSUM
TATAELXSI
TATAINVEST
TATAMOTORS
TATAPOWER
TATASTEEL
TATATECH
TCIEXP
TCNSBRANDS
TCS
TECHM
TEJASNET
TIMKEN
TITAN
TITAGARH
TORNTPOWER
TORNTPHARM
TRENT
TRITURBINE
TVSMOTOR
UBL
ULTRACEMCO
UNOMINDA
UNITDSPR
UPL
UTIAMC
VEDL
VENTIVE
VGUARD
VOLTAS
VTL
WAAREEENER
WHIRLPOOL
WIPRO
WOCKPHARMA
YESBANK
ZEEL
ZENTEC
ZENSARTECH
ZYDUSLIFE
ECLERX`;

export const STATIC_MCX_LIST = [
  "GOLD",
  "SILVER",
  "CRUDEOIL",
  "NATURALGAS",
  "COPPER",
  "ZINC",
  "ALUMINIUM",
  "LEAD"
];

export const STATIC_FOREX_LIST = [
  "USDINR",
  "EURINR",
  "GBPINR",
  "JPYINR",
  "EURUSD",
  "GBPUSD"
];

export const STATIC_CRYPTO_LIST = [
  "BTC",
  "ETH",
  "SOL",
  "BNB",
  "XRP",
  "ADA"
];

let NAME_CACHE: Map<string, string> | null = null;

const initNameCache = () => {
  if (NAME_CACHE) return;
  NAME_CACHE = new Map<string, string>();
  const lines = STATIC_NSE_LIST.split("\n");

  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    const parts = line.split(",");
    const sym = parts[0].trim().toUpperCase();
    if (sym) {
      NAME_CACHE.set(sym, sym);
    }
  }
};
export const getCompanyName = (symbol: string): string => {
  if (!NAME_CACHE) initNameCache();

  const base = symbol.toUpperCase().replace(/\.(NS|BO)$/i, "");

  if (NAME_CACHE && NAME_CACHE.has(base)) {
    return NAME_CACHE.get(base)!;
  }

  if (STATIC_MCX_LIST.includes(base)) {
    return base + " Futures (MCX)";
  }

  if (STATIC_FOREX_LIST.includes(base)) {
    const c1 = base.substring(0, 3);
    const c2 = base.substring(3);
    return c1 + "/" + c2 + " Forex";
  }

  // Crypto label removed as requested
  return base;
};

const parseCSV = (text: string): string[] => {
  const lines = text.split("\n");
  if (lines.length < 2) return [];

  const symbols: Set<string> = new Set();

  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;

    const cols = line.split(",");
    const sym = cols[0].trim().toUpperCase();

    if (sym && /^[A-Z0-9&-]+$/.test(sym) && sym !== "Symbol") {
      symbols.add(sym);
    }
  }

  return Array.from(symbols);
};

export const checkAndRefreshStockList = async (): Promise<string[]> => {
  return parseCSV(STATIC_NSE_LIST);
};
